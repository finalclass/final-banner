(function(){var f=jQuery;var e=function(){this.$dispatcher=f(this)};e.prototype={on:function(g,h){this.$dispatcher.bind(g,h)},emit:function(g,h){this.$dispatcher.trigger(g,h)}};var d=function(g){e.call(this);this.interval=g;this.tickCount=0;this.id;this.isRunning=false;this.onTimer=f.proxy(this.onTimer,this)};d.TICK="tick";d.prototype=Object.create(e.prototype);f.extend(d.prototype,{start:function(){if(!this.isRunning){this.id=setInterval(this.onTimer,this.interval);this.isRunning=true}},stop:function(){clearInterval(this.id);this.isRunning=false},onTimer:function(){this.tickCount+=1;this.emit(d.TICK,[this.tickCount])}});var a=function(){e.call(this);this.onImageLoaded=f.proxy(this.onImageLoaded,this);this.imagesToLoad=0;this.loadedImages=[]};a.COMPLETE="complete";a.PROGRESS="progress";a.prototype=Object.create(e.prototype);f.extend(a.prototype,{load:function(k,g){var j,h;this.imagesToLoad+=k.length;for(j=0;j<k.length;j+=1){h=f("<img/>").attr("src",g+k[j]);h.bind("load",this.onImageLoaded)}},onImageLoaded:function(g){this.loadedImages.push(g.target);if(this.imagesToLoad===this.loadedImages.length){this.emit(a.COMPLETE,[this.loadedImages])}else{this.emit(a.PROGRESS,[this.loadedImages.length/this.imagesToLoad])}}});var b=function(l,k,h,g,i,j){e.call(this);this.context1=l;this.context2=k;this.direction=j||+1;this.speed=i||50;this.width=h;this.height=g;this.data1=this.context1.getImageData(0,0,h,g);this.data2=this.context2.getImageData(0,0,h,g);this.pos=0;this.timer=new d(20);this.isRunning=false;this.onTick=f.proxy(this.onTick,this);this.timer.on(d.TICK,this.onTick)};b.TICK="tick";b.COMPLETE="complete";b.prototype=Object.create(e.prototype);f.extend(b.prototype,{start:function(){this.pos=0;this.isRunning=true;this.timer.start()},onTick:function(l,m){var r,z,v,A=this.width,s=this.height,u,n,o=this.context1.createImageData(this.width,this.height),t=o.data,k,j,g;if(this.direction>0){n=A-this.pos;j=this.data1.data,g=this.data2.data;k=0}else{n=this.pos;k=A*4;g=this.data1.data,j=this.data2.data}for(z=0;z<A;z+=1){for(v=0;v<s;v+=1){if(z<n){r=(v*A+z)*4;u=this.direction*this.pos*4+k;t[r]=j[r+u];t[r+1]=j[r+u+1];t[r+2]=j[r+u+2];t[r+3]=j[r+u+3]}else{r=(v*A+z)*4;u=-n*4;t[r]=g[r+u];t[r+1]=g[r+u+1];t[r+2]=g[r+u+2];t[r+3]=g[r+u+3]}}}this.emit(b.TICK,[o]);this.pos+=this.speed;if(this.pos>A){this.isRunning=false;this.timer.stop();this.emit(b.COMPLETE)}}});var c=function(i,g,h){this.$container=i;this.animationSpeed=h;this.$prev=f('<div class="banner-prev-image"></div>');this.$next=f('<div class="banner-next-image"></div>');this.canvas=f("<canvas/>")[0];this.canvas.width=i.width();this.canvas.height=i.height();this.ctx=this.canvas.getContext("2d");this.timer=new d(g);this.images=[];this.position=0;this.animation=undefined;this.onImagesLoadComplete=f.proxy(this.onImagesLoadComplete,this);this.onTimer=f.proxy(this.onTimer,this);this.onNextClick=f.proxy(this.onNextClick,this);this.onPrevClick=f.proxy(this.onPrevClick,this);this.onAnimationTick=f.proxy(this.onAnimationTick,this);this.onAnimationComplete=f.proxy(this.onAnimationComplete,this);this.$prev.bind("click",this.onPrevClick);this.$next.bind("click",this.onNextClick);this.timer.on(d.TICK,this.onTimer);this.canvas.width=926;this.canvas.height=238};c.prototype={animate:function(i,h){var g=new a();g.load(i,h);g.on(a.COMPLETE,this.onImagesLoadComplete)},showCurrentImage:function(){this.ctx.drawImage(this.images[this.position],0,0,this.canvas.width,this.canvas.height)},getImageAsContext:function(i){var h=f("<canvas/>")[0],g;h.width=this.canvas.width;h.height=this.canvas.height;g=h.getContext("2d");g.drawImage(i,0,0,this.canvas.width,this.canvas.height);return g},animatedPhotosSwitch:function(j,i,k){var h,g;h=this.getImageAsContext(this.images[j]);g=this.getImageAsContext(this.images[i]);this.animation=new b(h,g,this.canvas.width,this.canvas.height,this.animationSpeed,k);this.animation.on(b.COMPLETE,this.onAnimationComplete);this.animation.on(b.TICK,this.onAnimationTick);this.animation.start()},stop:function(){this.timer.stop()},start:function(){this.timer.start()},showNextImage:function(){var h,g;if(this.animation&&this.animation.isRunning){return}h=this.position;this.position=(this.position+1)%(this.images.length);g=this.position;this.animatedPhotosSwitch(h,g,+1)},showPrevImage:function(){var h,g;if(this.animation&&this.animation.isRunning){return}h=this.position;this.position=(this.position-1)%(this.images.length);if(this.position<0){this.position=this.images.length+this.position}g=this.position;if(this.position<0){this.position=this.images.length+this.position}this.animatedPhotosSwitch(h,g,-1)},isSupported:function(){var g=document.createElement("canvas");return !!(g.getContext&&g.getContext("2d"))},onNextClick:function(g){var h=this.timer.isRunning;this.stop();this.showNextImage();if(h){this.start()}},onPrevClick:function(g){var h=this.timer.isRunning;this.stop();this.showPrevImage();if(h){this.start()}},onImagesLoadComplete:function(h,g){this.images=this.images.concat(g);this.timer.start();this.$container.empty().append(this.$prev).append(this.$next).append(this.canvas);this.showCurrentImage()},onTimer:function(h,g){this.showNextImage()},onAnimationComplete:function(g){this.showCurrentImage()},onAnimationTick:function(g,h){this.ctx.putImageData(h,0,0)}};window.FinalBanner=c;f.fn.finalBanner=function(h){var i,j,g;if(typeof h==="string"){j=h;g=Array.prototype.slice.call(arguments,[1])}else{i=f.extend({switchTime:5000,animationSpeed:100,pathsPrefix:"",paths:[]},h)}return this.each(function(){var l=f(this),k;if(j!==undefined){k=l.data("finalBanner");k[j].call(k,g);return l}if(l.data("finalBanner")!==undefined){return}k=new c(f(this),i.switchTime,i.animationSpeed);if(k.isSupported){k.animate(i.paths,i.pathsPrefix);l.data("finalBanner",k)}return l})}})();